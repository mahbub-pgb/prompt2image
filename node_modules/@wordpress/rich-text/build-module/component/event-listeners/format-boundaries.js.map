{
  "version": 3,
  "sources": ["../../../src/component/event-listeners/format-boundaries.js"],
  "sourcesContent": ["/**\n * WordPress dependencies\n */\nimport { LEFT, RIGHT } from '@wordpress/keycodes';\n\n/**\n * Internal dependencies\n */\nimport { isCollapsed } from '../../is-collapsed';\n\nconst EMPTY_ACTIVE_FORMATS = [];\n\nexport default ( props ) => ( element ) => {\n\tfunction onKeyDown( event ) {\n\t\tconst { keyCode, shiftKey, altKey, metaKey, ctrlKey } = event;\n\n\t\tif (\n\t\t\t// Only override left and right keys without modifiers pressed.\n\t\t\tshiftKey ||\n\t\t\taltKey ||\n\t\t\tmetaKey ||\n\t\t\tctrlKey ||\n\t\t\t( keyCode !== LEFT && keyCode !== RIGHT )\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { record, applyRecord, forceRender } = props.current;\n\t\tconst {\n\t\t\ttext,\n\t\t\tformats,\n\t\t\tstart,\n\t\t\tend,\n\t\t\tactiveFormats: currentActiveFormats = [],\n\t\t} = record.current;\n\t\tconst collapsed = isCollapsed( record.current );\n\t\tconst { ownerDocument } = element;\n\t\tconst { defaultView } = ownerDocument;\n\t\t// To do: ideally, we should look at visual position instead.\n\t\tconst { direction } = defaultView.getComputedStyle( element );\n\t\tconst reverseKey = direction === 'rtl' ? RIGHT : LEFT;\n\t\tconst isReverse = event.keyCode === reverseKey;\n\n\t\t// If the selection is collapsed and at the very start, do nothing if\n\t\t// navigating backward.\n\t\t// If the selection is collapsed and at the very end, do nothing if\n\t\t// navigating forward.\n\t\tif ( collapsed && currentActiveFormats.length === 0 ) {\n\t\t\tif ( start === 0 && isReverse ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( end === text.length && ! isReverse ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// If the selection is not collapsed, let the browser handle collapsing\n\t\t// the selection for now. Later we could expand this logic to set\n\t\t// boundary positions if needed.\n\t\tif ( ! collapsed ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst formatsBefore = formats[ start - 1 ] || EMPTY_ACTIVE_FORMATS;\n\t\tconst formatsAfter = formats[ start ] || EMPTY_ACTIVE_FORMATS;\n\t\tconst destination = isReverse ? formatsBefore : formatsAfter;\n\t\tconst isIncreasing = currentActiveFormats.every(\n\t\t\t( format, index ) => format === destination[ index ]\n\t\t);\n\n\t\tlet newActiveFormatsLength = currentActiveFormats.length;\n\n\t\tif ( ! isIncreasing ) {\n\t\t\tnewActiveFormatsLength--;\n\t\t} else if ( newActiveFormatsLength < destination.length ) {\n\t\t\tnewActiveFormatsLength++;\n\t\t}\n\n\t\tif ( newActiveFormatsLength === currentActiveFormats.length ) {\n\t\t\trecord.current._newActiveFormats = destination;\n\t\t\treturn;\n\t\t}\n\n\t\tevent.preventDefault();\n\n\t\tconst origin = isReverse ? formatsAfter : formatsBefore;\n\t\tconst source = isIncreasing ? destination : origin;\n\t\tconst newActiveFormats = source.slice( 0, newActiveFormatsLength );\n\t\tconst newValue = {\n\t\t\t...record.current,\n\t\t\tactiveFormats: newActiveFormats,\n\t\t};\n\t\trecord.current = newValue;\n\t\tapplyRecord( newValue );\n\t\tforceRender();\n\t}\n\n\telement.addEventListener( 'keydown', onKeyDown );\n\treturn () => {\n\t\telement.removeEventListener( 'keydown', onKeyDown );\n\t};\n};\n"],
  "mappings": "AAGA,SAAS,MAAM,aAAa;AAK5B,SAAS,mBAAmB;AAE5B,MAAM,uBAAuB,CAAC;AAE9B,IAAO,4BAAQ,CAAE,UAAW,CAAE,YAAa;AAC1C,WAAS,UAAW,OAAQ;AAC3B,UAAM,EAAE,SAAS,UAAU,QAAQ,SAAS,QAAQ,IAAI;AAExD;AAAA;AAAA,MAEC,YACA,UACA,WACA,WACE,YAAY,QAAQ,YAAY;AAAA,MACjC;AACD;AAAA,IACD;AAEA,UAAM,EAAE,QAAQ,aAAa,YAAY,IAAI,MAAM;AACnD,UAAM;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,eAAe,uBAAuB,CAAC;AAAA,IACxC,IAAI,OAAO;AACX,UAAM,YAAY,YAAa,OAAO,OAAQ;AAC9C,UAAM,EAAE,cAAc,IAAI;AAC1B,UAAM,EAAE,YAAY,IAAI;AAExB,UAAM,EAAE,UAAU,IAAI,YAAY,iBAAkB,OAAQ;AAC5D,UAAM,aAAa,cAAc,QAAQ,QAAQ;AACjD,UAAM,YAAY,MAAM,YAAY;AAMpC,QAAK,aAAa,qBAAqB,WAAW,GAAI;AACrD,UAAK,UAAU,KAAK,WAAY;AAC/B;AAAA,MACD;AAEA,UAAK,QAAQ,KAAK,UAAU,CAAE,WAAY;AACzC;AAAA,MACD;AAAA,IACD;AAKA,QAAK,CAAE,WAAY;AAClB;AAAA,IACD;AAEA,UAAM,gBAAgB,QAAS,QAAQ,CAAE,KAAK;AAC9C,UAAM,eAAe,QAAS,KAAM,KAAK;AACzC,UAAM,cAAc,YAAY,gBAAgB;AAChD,UAAM,eAAe,qBAAqB;AAAA,MACzC,CAAE,QAAQ,UAAW,WAAW,YAAa,KAAM;AAAA,IACpD;AAEA,QAAI,yBAAyB,qBAAqB;AAElD,QAAK,CAAE,cAAe;AACrB;AAAA,IACD,WAAY,yBAAyB,YAAY,QAAS;AACzD;AAAA,IACD;AAEA,QAAK,2BAA2B,qBAAqB,QAAS;AAC7D,aAAO,QAAQ,oBAAoB;AACnC;AAAA,IACD;AAEA,UAAM,eAAe;AAErB,UAAM,SAAS,YAAY,eAAe;AAC1C,UAAM,SAAS,eAAe,cAAc;AAC5C,UAAM,mBAAmB,OAAO,MAAO,GAAG,sBAAuB;AACjE,UAAM,WAAW;AAAA,MAChB,GAAG,OAAO;AAAA,MACV,eAAe;AAAA,IAChB;AACA,WAAO,UAAU;AACjB,gBAAa,QAAS;AACtB,gBAAY;AAAA,EACb;AAEA,UAAQ,iBAAkB,WAAW,SAAU;AAC/C,SAAO,MAAM;AACZ,YAAQ,oBAAqB,WAAW,SAAU;AAAA,EACnD;AACD;",
  "names": []
}
